const form = document.getElementById('malware-form');
const resetContainer = document.getElementById('reset-container');
const resetBtn = document.getElementById('resetBtn');
const downloadBtn = document.getElementById("downloadBtn");
const resultsText = document.getElementById("results-text");

Module.onRuntimeInitialized = () => {
  const getEICAR = Module.cwrap("get_eicar_string", "string", []);

  downloadBtn.addEventListener("click", () => {
    form.hidden = true; // Hide form

    const eicarString = getEICAR();

    const blob = new Blob([eicarString], { type: "text/plain" });

    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'eicar.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    resultsText.innerText = eicarString;
    resetContainer.hidden = false; // Show results panel

  });
};


document.addEventListener('DOMContentLoaded', function () {

    resetBtn.addEventListener('click', function() {
        // Reset form values
        form.reset();
        form.hidden = false; // Show form
        resetContainer.hidden = true; // Hide results panel
        
        // Clear URL parameters
        window.history.replaceState({}, document.title, window.location.pathname);
    });
});
